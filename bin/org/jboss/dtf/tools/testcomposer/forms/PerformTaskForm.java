/*
 * JBoss, Home of Professional Open Source
 * Copyright 2008, Red Hat Middleware LLC, and individual contributors
 * as indicated by the @author tags.
 * See the copyright.txt in the distribution for a
 * full listing of individual contributors.
 * This copyrighted material is made available to anyone wishing to use,
 * modify, copy, or redistribute it subject to the terms and conditions
 * of the GNU Lesser General Public License, v. 2.1.
 * This program is distributed in the hope that it will be useful, but WITHOUT A
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 * PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.
 * You should have received a copy of the GNU Lesser General Public License,
 * v.2.1 along with this distribution; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
 * MA  02110-1301, USA.
 *
 * (C) 2008,
 * @author JBoss Inc.
 */
/*
 * PerformTaskForm.java
 *
 * Created on 11 April 2002, 13:30
 */

package org.jboss.dtf.tools.testcomposer.forms;

import org.jboss.dtf.testframework.coordinator.TaskDefinition;
import org.jboss.dtf.testframework.coordinator.Action;
import org.jboss.dtf.testframework.coordinator.actions.PerformAction;
import org.jboss.dtf.testframework.coordinator.actions.StartAction;

import javax.swing.*;

/**
 *
 * @author  rabegg
 */
public class PerformTaskForm extends javax.swing.JDialog
{

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField nameListEdit;
    private javax.swing.JPanel buttonPanel;
    private javax.swing.JButton jvmRemoveButton;
    private javax.swing.JButton clearAllButton;
    private javax.swing.JList jvmParameterList;
    private javax.swing.JLabel runtimeIdLabel;
    private javax.swing.JButton okButton;
    private javax.swing.JButton addButton;
    private javax.swing.JButton cancelButton;
    private javax.swing.JTextField runtimeIdEdit;
    private javax.swing.JComboBox locationCombo;
    private javax.swing.JButton jvmClearAllButton;
    private javax.swing.JLabel jvmParametersLabel;
    private javax.swing.JLabel nameListLabel;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JList parameterList;
    private javax.swing.JLabel taskLabel;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JLabel parameterLabel;
    private javax.swing.JLabel taskIdText;
    private javax.swing.JLabel locationLabel;
    private javax.swing.JButton jvmAddButton;
    private javax.swing.JButton removeButton;
    private javax.swing.JLabel timeoutLabel;
    private javax.swing.JTextField timeoutEdit;
    private javax.swing.JComboBox typeCombo;
    private javax.swing.JLabel typeLabel;
    private javax.swing.JLabel runnerLabel;
    private javax.swing.JTextField runnerEdit;
    private boolean _perform = false;
    private Action  _action;
    // End of variables declaration//GEN-END:variables

    /** Creates new form PerformTaskForm */
    public PerformTaskForm(java.awt.Frame parent, boolean modal)
    {
        super(parent, modal);
        initComponents();
    }

    public Action getAction()
    {
        return(_action);
    }

    public void setData(boolean perform, TaskDefinition task, String fullTaskId)
    {
        this.setTitle( (perform?"Perform":"Start")+" Task");

        _perform = perform;
        parameterList.setAutoscrolls(true);
        taskIdText.setText(fullTaskId);

        for (int count=0;count<Action.LOCATION_STRINGS.length;count++)
        {
            locationCombo.addItem(Action.LOCATION_STRINGS[count]);
        }
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        java.awt.GridBagConstraints gridBagConstraints;

        jPanel1 = new javax.swing.JPanel();
        taskLabel = new javax.swing.JLabel();
        taskIdText = new javax.swing.JLabel();
        locationLabel = new javax.swing.JLabel();
        locationCombo = new javax.swing.JComboBox();
        nameListLabel = new javax.swing.JLabel();
        nameListEdit = new javax.swing.JTextField();
        runtimeIdLabel = new javax.swing.JLabel();
        runtimeIdEdit = new javax.swing.JTextField();
        jPanel2 = new javax.swing.JPanel();
        parameterLabel = new javax.swing.JLabel();
        parameterList = new javax.swing.JList(new DefaultListModel());
        buttonPanel = new javax.swing.JPanel();
        addButton = new javax.swing.JButton();
        removeButton = new javax.swing.JButton();
        clearAllButton = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        jvmParametersLabel = new javax.swing.JLabel();
        jvmParameterList = new javax.swing.JList(new DefaultListModel());
        jPanel4 = new javax.swing.JPanel();
        jvmAddButton = new javax.swing.JButton();
        jvmRemoveButton = new javax.swing.JButton();
        jvmClearAllButton = new javax.swing.JButton();
        jPanel5 = new javax.swing.JPanel();
        okButton = new javax.swing.JButton();
        cancelButton = new javax.swing.JButton();
        timeoutLabel = new javax.swing.JLabel();
        timeoutEdit = new javax.swing.JTextField();
        typeCombo = new javax.swing.JComboBox();
        typeLabel = new javax.swing.JLabel();
        runnerEdit = new javax.swing.JTextField();
        runnerLabel = new javax.swing.JLabel();

        getContentPane().setLayout(new java.awt.GridBagLayout());

        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                closeDialog(evt);
            }
        });

        jPanel1.setLayout(new java.awt.GridBagLayout());

        taskLabel.setText("Task Id:");
        taskLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        taskLabel.setPreferredSize(new java.awt.Dimension(99, 17));
        taskLabel.setMinimumSize(new java.awt.Dimension(99, 17));
        taskLabel.setMaximumSize(new java.awt.Dimension(99, 17));
        taskLabel.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        jPanel1.add(taskLabel, gridBagConstraints);

        taskIdText.setText("xxxxxxxxxx");
        taskIdText.setFont(new java.awt.Font("Dialog", 0, 12));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel1.add(taskIdText, gridBagConstraints);

        locationLabel.setText("Location:");
        locationLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        locationLabel.setPreferredSize(new java.awt.Dimension(99, 17));
        locationLabel.setMinimumSize(new java.awt.Dimension(99, 17));
        locationLabel.setMaximumSize(new java.awt.Dimension(99, 17));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        jPanel1.add(locationLabel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel1.add(locationCombo, gridBagConstraints);

        typeLabel.setText("Type:");
        typeLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        typeLabel.setPreferredSize(new java.awt.Dimension(99, 17));
        typeLabel.setMinimumSize(new java.awt.Dimension(99, 17));
        typeLabel.setMaximumSize(new java.awt.Dimension(99, 17));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        jPanel1.add(typeLabel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;

        for (int count=0;count<TaskDefinition.TYPE_STRINGS.length;count++)
        {
            typeCombo.addItem(TaskDefinition.TYPE_STRINGS[count]);
        }

        jPanel1.add(typeCombo, gridBagConstraints);

        nameListLabel.setText("Name List:");
        nameListLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        nameListLabel.setPreferredSize(new java.awt.Dimension(99, 17));
        nameListLabel.setMinimumSize(new java.awt.Dimension(99, 17));
        nameListLabel.setMaximumSize(new java.awt.Dimension(99, 17));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        jPanel1.add(nameListLabel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel1.add(nameListEdit, gridBagConstraints);

        runtimeIdLabel.setText("Runtime Id:");
        runtimeIdLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        runtimeIdLabel.setPreferredSize(new java.awt.Dimension(99, 17));
        runtimeIdLabel.setMinimumSize(new java.awt.Dimension(99, 17));
        runtimeIdLabel.setMaximumSize(new java.awt.Dimension(99, 17));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        jPanel1.add(runtimeIdLabel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        jPanel1.add(runtimeIdEdit, gridBagConstraints);

        timeoutLabel.setText("Timeout:");
        timeoutLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        timeoutLabel.setPreferredSize(new java.awt.Dimension(99, 17));
        timeoutLabel.setMinimumSize(new java.awt.Dimension(99, 17));
        timeoutLabel.setMaximumSize(new java.awt.Dimension(99, 17));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        jPanel1.add(timeoutLabel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        timeoutEdit.setText("0");
        jPanel1.add(timeoutEdit, gridBagConstraints);

        runnerLabel.setText("Runner:");
        runnerLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        runnerLabel.setPreferredSize(new java.awt.Dimension(99, 17));
        runnerLabel.setMinimumSize(new java.awt.Dimension(99, 17));
        runnerLabel.setMaximumSize(new java.awt.Dimension(99, 17));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        jPanel1.add(runnerLabel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        jPanel1.add(runnerEdit, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(3, 3, 3, 3);
        getContentPane().add(jPanel1, gridBagConstraints);

        jPanel2.setLayout(new java.awt.GridBagLayout());

        parameterLabel.setText("Parameters:");
        parameterLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        parameterLabel.setPreferredSize(new java.awt.Dimension(99, 17));
        parameterLabel.setMinimumSize(new java.awt.Dimension(99, 17));
        parameterLabel.setMaximumSize(new java.awt.Dimension(99, 17));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTH;
        jPanel2.add(parameterLabel, gridBagConstraints);

        parameterList.setPreferredSize(new java.awt.Dimension(150, 125));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        jPanel2.add(new JScrollPane(parameterList), gridBagConstraints);

        buttonPanel.setLayout(new java.awt.GridLayout(3, 1));

        addButton.setMnemonic('a');
        addButton.setText("add");
        addButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addButtonActionPerformed(evt);
            }
        });

        buttonPanel.add(addButton);

        removeButton.setMnemonic('r');
        removeButton.setText("remove");
        removeButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                removeButtonActionPerformed(evt);
            }
        });

        buttonPanel.add(removeButton);

        clearAllButton.setMnemonic('c');
        clearAllButton.setText("clear all");
        clearAllButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                clearAllButtonActionPerformed(evt);
            }
        });

        buttonPanel.add(clearAllButton);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel2.add(buttonPanel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(3, 1, 3, 1);
        getContentPane().add(jPanel2, gridBagConstraints);

        jPanel3.setLayout(new java.awt.GridBagLayout());

        jvmParametersLabel.setText("JVM Parameters:");
        jvmParametersLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTH;
        jPanel3.add(jvmParametersLabel, gridBagConstraints);

        jvmParameterList.setPreferredSize(new java.awt.Dimension(150, 125));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTH;
        jPanel3.add(new JScrollPane(jvmParameterList), gridBagConstraints);

        jPanel4.setLayout(new java.awt.GridLayout(3, 1));

        jvmAddButton.setMnemonic('d');
        jvmAddButton.setText("add");
        jvmAddButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jvmAddButtonActionPerformed(evt);
            }
        });

        jPanel4.add(jvmAddButton);

        jvmRemoveButton.setMnemonic('e');
        jvmRemoveButton.setText("remove");
        jvmRemoveButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jvmRemoveButtonActionPerformed(evt);
            }
        });

        jPanel4.add(jvmRemoveButton);

        jvmClearAllButton.setMnemonic('l');
        jvmClearAllButton.setText("clear all");
        jvmClearAllButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jvmClearAllButtonActionPerformed(evt);
            }
        });

        jPanel4.add(jvmClearAllButton);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel3.add(jPanel4, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(3, 3, 3, 3);
        getContentPane().add(jPanel3, gridBagConstraints);

        jPanel5.setPreferredSize(new java.awt.Dimension(130, 40));
        okButton.setMnemonic('o');
        okButton.setText("ok");
        okButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                okButtonActionPerformed(evt);
            }
        });

        jPanel5.add(okButton);

        cancelButton.setMnemonic('n');
        cancelButton.setText("cancel");
        jPanel5.add(cancelButton);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        getContentPane().add(jPanel5, gridBagConstraints);

        pack();
    }//GEN-END:initComponents

    private void jvmClearAllButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jvmClearAllButtonActionPerformed
        // Add your handling code here:
    }//GEN-LAST:event_jvmClearAllButtonActionPerformed

    private void jvmRemoveButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jvmRemoveButtonActionPerformed
        // Add your handling code here:
    }//GEN-LAST:event_jvmRemoveButtonActionPerformed

    private void jvmAddButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jvmAddButtonActionPerformed
        // Add your handling code here:
    }//GEN-LAST:event_jvmAddButtonActionPerformed

    private void clearAllButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_clearAllButtonActionPerformed
        // Add your handling code here:
    }//GEN-LAST:event_clearAllButtonActionPerformed

    private void removeButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_removeButtonActionPerformed
        // Add your handling code here:
    }//GEN-LAST:event_removeButtonActionPerformed

    private void okButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_removeButtonActionPerformed
        if (_perform)
        {
            _action = new PerformAction( this.taskIdText.getText(),this.runtimeIdEdit.getText(), (String)this.locationCombo.getSelectedItem(),
                    getParameters(),getJVMParameters(), nameListEdit.getText() );
        }
        else
        {
            System.out.println("Creating new start action");
            _action = new StartAction( taskIdText.getText(), runtimeIdEdit.getText(), (String)locationCombo.getSelectedItem(),
                    getParameters(),getJVMParameters(), nameListEdit.getText() );
            System.out.println("Created = "+_action);
        }
        System.out.println("ok complete");
        closeDialog(null);
    }//GEN-LAST:event_removeButtonActionPerformed

    public String[] getParameters()
    {
        DefaultListModel parameterDataModel = (DefaultListModel)parameterList.getModel();
        String[] results = new String[parameterDataModel.getSize()];

        System.arraycopy(parameterDataModel.toArray(),0,results,0,results.length);
        return(results);
    }

    public String[] getJVMParameters()
    {
        DefaultListModel jvmParameterDataModel = (DefaultListModel)jvmParameterList.getModel();
        String[] results = new String[jvmParameterDataModel.getSize()];

        System.arraycopy(jvmParameterDataModel.toArray(),0,results,0,results.length);
        return(results);
    }

    private void addButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addButtonActionPerformed
        ParameterForm parameterForm = new ParameterForm(null);
        parameterForm.show();

        String parameter = parameterForm.getParameter();

        if ( parameter != null )
        {
            DefaultListModel model = (DefaultListModel)parameterList.getModel();

            model.addElement(parameter);
        }
    }//GEN-LAST:event_addButtonActionPerformed

    /** Closes the dialog */
    private void closeDialog(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_closeDialog
        setVisible(false);
        dispose();
    }//GEN-LAST:event_closeDialog
}
